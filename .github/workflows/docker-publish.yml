name: Build and publish a Docker image

on:
  push:
    branches: [ main ]

env:
  REGISTRY: ghcr.io
  # github.repository as <account>/<repo>
  IMAGE_NAME: ${{ github.repository }}
  IMAGE_LABEL: latest

jobs:
  release:
    runs-on: ubuntu-latest       
    steps:
      - name: update scheduler
        uses: sekassel-research/actions-rancher-update@1.1.4
        with:
          rancher_url: https://rancher.dev.economia.gov.br
          rancher_access: ${{ secrets.RANCHER_ACCESS }}
          rancher_key: ${{ secrets.RANCHER_KEY }}
          project_id: 1a656207
          stack_name: airflow2-hmg
          service_name: airflow-scheduler
          docker_image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ env.IMAGE_LABEL }} 
          
